<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8">
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <script src="../node_modules/cesium/Build/Cesium/Cesium.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://unpkg.com/bootstrap-table@1.14.2/dist/bootstrap-table.min.js"></script>

  <!-- <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/index.css"></link>
  <script src = "/js/satellite.min.js"> </script> 
  <script src = "/js/dat.gui.min.js"> </script> 
  <script src = "/js/KeplerianElement.js"> </script> 
  <script src="/js/Catalogue.js"></script>
  <script src="/js/DefineGlobalParameters.js"></script>
  <script src="/js/ApiHandler.js"></script>
  <script src="/js/Views/MainEarthView.js"></script>
  <script src="/js/HTMLElementHandler.js"></script>
  <script src="/js/Views/hotspot.js"></script>
  <script src="/js/Views/one_year.js"></script>
  <script src="/js/Views/two_year.js"></script>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #65737e ;">
    <a class="navbar-brand" href="#">Future Space Populations</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <!-- <li class="nav-item col-md-auto">
          <a class="nav-link" href="#" onclick="numberOfLoads();">View 1 Year <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item col-md-auto">
          <a class="nav-link" href="#" onclick="twoYear();">Compare 2 Years</a>
        </li>
        <li class="nav-item col-md-auto">
          <a class="nav-link" href="#" onclick="hotspotData();">Hotspot Analysis</a>
        </li> -->
        <li class="nav-item">
          <a class="nav-link" data-toggle="modal" data-target="#modal">The Science Behind</a>
        </li>
      </ul>
      <ul class="nav navbar-nav ml-auto">
        <!-- <li class="nav-item">
          <a class="nav-link" data-toggle="modal" data-target="#modal_help">About</a>
        </li> -->
        <li class="nav-item">
          <a class="nav-link" data-toggle="modal" data-target="#modal_about">Help</a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="card border-dark mb-3" id="satelliteLegend">
    <div class="card-body text">
      <h5 class="card-title">Object Type</h5>
      <div class="box red"></div><p class="card-text" style="white-space: pre; white-space: after;"> Debris</p>
      <div class="box yellow"></div><p class="card-text" style="white-space: pre; ">Active Satellite</p>
    </div> 
  </div>

  <div class="card border-dark mb-3" id="objectTable" style="display: none;">
    <div class="card-body text">
      <table class="table table-sm table-hover" id="objectTableBootstrap" data-toggle="table">
          <thead>
              <tr>
                  <th data-field="param">Item ID</th>
                  <th data-field="value">Item Name</th>
              </tr>
          </thead>
      </table>
      <button type="button" class="btn-close" aria-label="Close" id="objectTableCloseButton" onclick="closeObjectInfoTable()"></button>
    </div> 
  </div>

  <div id="cesiumContainer">
    <form class="example" id = "button1year" style="margin:auto;max-width:300px; z-index: 9998;">
      <input id="1yearsearch" type="text" placeholder="Enter a Year.." name="search">
      <button type="button" onclick="whichMap(1)" style="background-color: #65737e ;"><i class="fa fa-search"></i></button>
    </form>
    <form class="example1" id = "button2year" style="margin:auto;max-width:300px; z-index: -100;">
      <input id="button2yearval" type="text" placeholder="Enter a Year.." name="search">
      <button type="button" onclick="addSecondYearSatelliteData()" style="background-color: #65737e ;"><i class="fa fa-search"></i></button>
    </form>

    <!-- For the spinner when needed -->
    <form class="example" id="spinner" style="margin:auto;max-width:300px; z-index: -9999;">
      <button class=" btn btn-primary" type="button" style="background-color: #65737e ;" disabled>
        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" ></span>
        <span class="sr-only">Loading...</span>
      </button>
    </form>

    <!-- For the dropdown box -->
    <form class="drop" id="dropdown" style="margin:auto;max-width:300px; z-index: 9999;">
      <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Search By Country (Optional)
      </button>
      <div class="dropdown-menu">
        <a class="dropdown-item" href="#" onclick="whichMap(2)">US</a>
        <a class="dropdown-item" href="#">CIS (Russia)</a>
        <a class="dropdown-item" href="#">UK</a>
        <!-- <div class="dropdown-divider"></div> -->
        <a class="dropdown-item" href="#">Iran</a>
      </div>
    </form>

    <div class="btn-group btn-group-toggle" id = "hotspot_toolbar" data-toggle="buttons" style="margin:auto;max-width:50%; z-index: -9999;  position: absolute; left:37%; top:10%; width:5%;">
      <label class="btn btn-secondary active">
        <input type="radio" name="options" id="option1" autocomplete="off" checked onclick="plotHotspotYear(1990);"> 1990
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="options" id="option2" autocomplete="off" onclick="plotHotspotYear(2000);"> 2000
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="options" id="option3" autocomplete="off" onclick="plotHotspotYear(2010);"> 2010
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="options" id="option3" autocomplete="off" onclick="plotHotspotYear(2015);"> 2015
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="options" id="option3" autocomplete="off" onclick="plotHotspotYear(2020);"> 2020
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="options" id="option3" autocomplete="off" onclick="plotHotspotYear(2025);"> 2025
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="options" id="option3" autocomplete="off" onclick="plotHotspotYear(2030);"> 2030
      </label>
    </div>

    <div class="container-fluid" >
      <div class="row">
        <div class="col-sm-2 d-flex justify-content-center" id="hotspot_legend" style="top:30px; z-index: -9999;">
          <div class="card border-dark mb-3"  style = "max-width: 18rem; margin:auto;  position: absolute;background-color: #6C757D  ;">
            <!-- <div class="card-header text"></div> -->
            <div class="card-body text">
              <h5 class="card-title">Number of Satellites</h5>
              <h5 class="card-title">in LEO, < 1000 km</h5>
              <div class="box forestgreen"></div><p class="card-text" style="white-space: pre;">  0 - 5</p>
              <div class="box gold"></div><p class="card-text" style="white-space: pre;">  6-10</p>
              <div class="box orange"></div><p class="card-text" style="white-space: pre;">  11-15</p>
              <div class="box darkorange"></div><p class="card-text" style="white-space: pre;">  16-20</p>
              <div class="box red"></div><p class="card-text" style="white-space: pre;">  20+</p>
            </div>
          </div>
        </div>  
      </div>
    </div>

  <div id="modal" class="modal" style="z-index: 9999;">
    <div class="modal-inner modal-lg">
      <center><h1>The Science Behind</h1></center>
    </br>
      <center><h2 style="font-size:22px">Mapping a Satellite's Location</h2></center>
      <img src="./images/geocentric_coordinate_system.JPG" alt="Geocentric Coordinate System" ALIGN="right" style="width:25%; height: 25%;">
      <p>Firstly, to understand how the track of a satellite is calculated, one must understand geocentric coordinate systems. The figure to the right shows essentially an X, Y, Z coordinate system, whereby 0,0,0 is the center of the earth. For every satellite, at each given time, their location can be calculated based on their X and Y value, and then their height from the center of the earth.  </p>
      <p>This is slightly useful for "snap-shots" of what space would look like (such as the hotspot mapping), however, as satellites often travel at speeds of 3, 900 km/hr, it is important to understand their trajectories. The science behind this is called <i>orbital mechanics.</i></p>
      </br>
      <p> Sir Isaac Newton, proposed three laws of motion. The first, describes how when an object travels in a given direction, it continues at a constant velocity, unless it is acted upon by an external force. Satellites in space will experience many forces against it, including gravity, atmospheric drag, thrust etc. However, these are all relatively small forces, creating a scerario where the satellite will orbit the earth.
        This is extremely important, as if the forward momentum of the satellite is too small, it will speed past and not enter orbit, however, if too small, the object will be pulled down to earth and crash.
      </p>

      <p>Therefore, if we assume that once a satellite is in orbit, it will remain on a continous trajectory. Then there are a number of orbital qualities to be able to calculate the position in said orbit.</p>

     <center><img src="./images/semi_major_axis.JPG" style="height: 35%; width: 35%;"><img src="./images/satellite_angles.JPG" alt="Satellite Orbital Parameters" style="height: 35%; width: 35%;"></center>

     <h3 style="font-size:18px">Semi-Major Axis and Eccentricity</h3>
    <p>The figure above reveals the orbital path for two objects, F1 and F2, where a and b are the semi-major and semi-minor axes respectively. This is a line segment that runs between the center of both F1 and F2, then ends at the orbit. The furthest distance on the elliptical point is called the apogee, and the shortest is the perigee. </p>
    <p>These lengths can be used to measure the eccentricity, will refers to the shape of the orbit. <i>Eccentricity (e)</i> is represented by a value between 0 and 1, where, e = 0 is a perfect circle. </p> 

    <h3 style="font-size:18px">Inclination</h3>
    <img src="./images/satellite_inclination.JPG" alt="Satellite Inclination" ALIGN="right" style="width:25%; height: 25%;">

    <p>After the size and the shape of the orbit has been calculated, next we have to understand the tilt compared to the equator of the earth, this is called the inclination. The inclination angle, is the path relative to the equator, if a satellite's path is directly above the equator, the inclination is 0. If a satellite orbits from the north pole to the south pole (geographic), the inclination is 90 degrees.</p>

    <h3 style="font-size:18px">RAAN</h3>
    <p>The Right Ascension of the Ascending Node (RAAN, Ω) is the angle in the equator plane taken from the First Point of Aires, which is the vernal equinox, which does not rotate with the earth. In simpler terms, this is the exact point where the satellite's orbit crosses the equatorial plane.</p>

    <h3 style="font-size:18px">Argument of Periapsis</h3>
    <p>The  argument  of  periapsis  (ω), or <i>perigee</i>, is the angle between the ascending node and the perigee directions, measured along the orbital plane. An value of 0&#176; means that the orbital body will be at its closest appraoch to the central body and the same moment that it crosses the plane of reference from the South to North. A value of 90&#176; means that the orbit body will reach periapsis at is north-most distance from the plane of reference.</p>
    <h3 style="font-size:18px">True Anomaly</h3>
    <img src="./images/true_anomaly.JPG" alt="True Anomaly" ALIGN="right" style="width:25%; height: 25%;">
    <p></br>True Anomaly, V, specifies the location of a spacecraft in orbit. It is the angle between the perigee and the spacecraft's position vector measured in the direction of the satellite's motion. Of all of the orbital elements, the true anomaly is the only one that changes with time. </p>

    </br>
    </br>

    <p><b>Overall</b>, the size and shape of the orbit is determined by the eccentricity and semi-major axis. The orientation, from the inclincation and longitude of the ascending node. The position is the argument of periapsis, and the true anomaly. For each satellite, these values can be calculated for a given time, and vectors of trajectory can be calculated to visualise where the satellite is along its orbit. Therefore, on the maps, the animation is just a smoothed version, of the position constantly being calculted and updated.</p>

    <center><h2 style="font-size:22px">Predicting the Future</h2></center>

    <p> The satellite data has been produced by the UCL Future Space Population Study, with partnership with the UCL Orbit Dynamics Library (a codebase that has been developed solely for the purpose to study the impact of force modelling strategies). The outline of the methodology to produce a prediction of space is shown below. </p>

    <center><img src="images/satellite_prediction.JPG" alt= "Satellite Prediction Methodology" ALIGN="center" style="width: 80%;"></center>
    <p> </p>
    <p>For each of the years that are visualised on this website, firstly, a user sets a baseline satellite catalogue, for this project, the baseline is 2019. In practical terms, this means that the true population of space is scraped from Celestrak.com and JSR (Jonathan’s Space Report) and used for all future simulations. This information will also include the Keplerian Elements for each of the space objects – as described in the section above. </p>
    <p>To simulate future launches, mostly, data would be scraped from different web sources on future launch dates. Therefore, all the satellites are what was available in 2019, plans have likely changed since then, and likely to have increased the number of satellite launces. For operational objects in low earth orbit ( <1000 km), the mission end-date corresponds to the known decay rate, if not known that the object remains operational. </p>
    <p>Furthermore, for future population simulations, the effects of on-orbit satellite fragmentation is also modelled. These are in three main categories: Explosion, On-Orbit Breakups (collisions etc.) or unknown cause. This is modelled through historical events from 1980s onwards. From 2019-2043, the number predicted is ~5.</p>


    </div>
  </div>

  <div id="modal_about" class="modal" style="z-index: 9999;">
    <div class="modal-inner modal-lg">
      <center><h1>Help</h1></center>
      <h3 style="font-size:18px">The Map Itself</h3>
      <p> If you are struggling with how to zoom in on the map etc., click off this pop-up, and in the top-right of the map there is a '?' button. This will show you how to navigate the map.</p>
      <p> In the bottom left of the map is the clock. Once a year is clicked, the map will plot the satellites movement from your current time. It will automatically be set at 100x normal time, please feel free to change this by sliding the green triangle left and right.</p>

      <h3 style="font-size:18px">One Year</h3>
      <p>This is the basic map template, you can enter the year of choice in the search bar at the top-left of the page. Make sure that the year you enter is in the format 'YYYY', ensuring that it is between 1957-2030. There will be a little loading period, as the data is plotted. Especially for years after 2020, as the map is trying to plot ~15,000 points!</p>
      <h3 style="font-size:18px">Two Year</h3>
      <p>The style of this map is the same as the One Year, apart from it allows the user to view two maps at the same time. The second search box that will appear will be for the second map. All the same rules above apply.</p>
      <h3 style="font-size:18px">Hotspot</h3>
      <p>This is a proof on concept to see if it is easier to understand how future space popualtions are changing. For each hexagon, simply the number of satellites are counted. As the simulation provides all of the new satellites, only the number at the equator will change. This will be updated in future versions.</p>
    </div>
  </div>
<script>

dragElement(document.getElementById("satelliteLegend"));
dragElement(document.getElementById("objectTable"));

function dragElement(elmnt) {
    var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    if (document.getElementById(elmnt.id + "header")) {
        /* if present, the header is where you move the DIV from:*/
        document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
    } else {
        /* otherwise, move the DIV from anywhere inside the DIV:*/
        elmnt.onmousedown = dragMouseDown;
    }

    function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        // get the mouse cursor position at startup:
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        // call a function whenever the cursor moves:
        document.onmousemove = elementDrag;
    }

    function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        // calculate the new cursor position:
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        // set the element's new position:
        elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
        elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
    }

    function closeDragElement() {
        /* stop moving when mouse button is released:*/
        document.onmouseup = null;
        document.onmousemove = null;
    }       
}

// stop the enter button being used in the entire project, this is stop the page refreshing when searching for a year
$(document).ready(function() {
    $(window).keydown(function(event){
      if(event.keyCode == 13) {
        // event.preventDefault();
        // return false;
        // get value of the box 
        if (document.getElementById('1yearsearch').value != null) {
          whichMap(1);
        } else {
          alert('You have not entered a year!');
        }
      }
    });
  });

function closeObjectInfoTable() {
  if(document.getElementById("objectTable").style.display != "none") {
    document.getElementById("objectTable").style.display = "none"
  }
}

Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjODcyZDRmZC03ZmUzLTQwNTktOTM4Mi1jMmI0OWIwODY2NDkiLCJpZCI6NTcwMTcsImlhdCI6MTYyMTk2ODM2NH0.lzeb9LrtQ6y3uotDuKUN3djp1kz-4o5BMq5c8uIe_tU';

var viewer_main = new Cesium.Viewer('cesiumContainer', {
    terrainProvider : Cesium.createWorldTerrain(),
    shouldAnimate: true,
});

var radar_viewer, viewer_hotspot;
var viewer2;
var start_jd;
var clockViewModel; 
var data_load=false;
var data_load2 = false;
var debris_collection;
var debris_collection2;
var satcat;
var satcat2;
var count = 0;
var one_year_clicked = false;
var two_year_clicked = false;
var hotspot_data = false;

var options3D = {
  homeButton : false,
  fullscreenButton : false,
  sceneModePicker : false,
  clockViewModel : clockViewModel,
  infoBox : false,
  geocoder : false,
  sceneMode : Cesium.SceneMode.SCENE3D,
  navigationHelpButton : false,
  animation : false,
  CreditDisplay : false,
  timeline: false,
  baseLayerPicker : false
};

var options2D = {
  homeButton : false,
  fullscreenButton : false,
  sceneModePicker : true,
  clockViewModel : clockViewModel,
  infoBox : true,
  geocoder : false,
  sceneMode : Cesium.SceneMode.SCENE2D,
  navigationHelpButton : false,
  animation : false,
  CreditDisplay : false,
  timeline: false,
  baseLayerPicker : false
};

document.addEventListener('DOMContentLoaded', function() {
  LoadLiveSatelliteData();
}, false)

// function whichMap(val) {
//   document.getElementById('hotspot_toolbar').style.zIndex = -9990;
//   try {viewer_main.dataSources.removeAll();} catch (err) {console.log(err);}
  
//   if (two_year_clicked == false) {
//     numberOfLoads();
//     document.getElementById('button2year').style.zIndex = -100;
//   } else {    
//     if (!satcat) {
//       oneYearLoad();
//     } else {
//       satcat.clear_catalog();
//       data_load = false;
//       debris_collection.removeAll();
//       debri_collection_radar.removeAll();
//       oneYearLoad();
//     }
//   } 
// }

function getURL(year) {
  var url;
  if (!year) {
    url = "https://satellite-api.herokuapp.com/2019/2019";
  }
  else if (year <= 2019) {
    url = "https://satellite-api.herokuapp.com/2019/" + year;
  } 
  // else if (2019 < year <= 2023) {
  //   url = "http://satellite-api.herokuapp.com/2023/" + year;
  // }
  else if (2019 < year <= 2025) {
    url = "https://satellite-api.herokuapp.com/2025/" + year;
  }
  else if (2025 < year <= 2027) {
    url = "https://satellite-api.herokuapp.com/2027/" + year;
  }
  else if (2027 < year <= 2029) {
    url = "https://satellite-api.herokuapp.com/2029/" + year;
  }

  return url;
}
  
</script>
</body>
</html>